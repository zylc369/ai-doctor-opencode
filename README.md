# AI Doctor

一个基于 OpenCode 的 AI 医生诊断系统，能够进行疾病诊断并提供治疗建议。

## 功能特点

- **智能问诊**：通过结构化问题收集患者症状和病史
- **病历分析**：支持上传和分析患者病历文件
- **医学研究**：实时搜索最新的医学文献、治疗指南和协议
- **鉴别诊断**：基于症状和研究结果进行精准诊断
- **治疗建议**：提供基于循证医学的治疗方案
- **SOAP 报告**：生成标准的医疗记录文档（主观、客观、评估、计划）
- **多语言支持**：自动跟随患者症状描述的语言输出
- **历史记录**：保存问诊过程和最终报告，支持复诊

## 工作流程

诊断过程包含以下 6 个阶段：

1. **患者信息** - 获取患者姓名和基本信息
2. **问诊阶段** - 使用结构化问题收集症状和病史
3. **研究阶段** - 搜索医学文献、指南和治疗方案
4. **诊断阶段** - 综合分析确定诊断
5. **治疗阶段** - 制定基于循证医学的治疗计划
6. **报告生成** - 输出 SOAP 格式的完整医疗记录

## 系统要求

- [OpenCode](https://opencode.ai) 环境
- 支持的 AI 模型（包括免费模型）
- 网络连接（用于医学文献搜索）

## 安装方法

1. **克隆仓库**

```bash
git clone https://github.com/yourusername/ai-doctor-opencode.git
cd ai-doctor-opencode
```

2. **全局安装（可选）**

将`.opencode/commands/dr-diagnose.md`拷贝到`~/.config/opencode/commands/dr-diagnose.md`。

**快捷命令：**`cp .opencode/commands/dr-diagnose.md ~/.config/opencode/commands/dr-diagnose.md`。

3. **在 OpenCode 中加载项目**

将项目目录添加到 OpenCode 的工作空间中。

## 使用方法

### 基本用法

在 OpenCode 中运行诊断命令：

```
/dr-diagnose [症状描述] [患者姓名]
```

### 参数说明

- `[症状描述]`（必需）：患者的主要症状
- `[患者姓名]`（可选）：患者的姓名

### 示例

```bash
# 诊断头痛症状，患者名为张三
/dr-diagnose 头痛 张三

# 诊断发热症状，稍后输入患者名
/dr-diagnose 发热
```

### 问诊流程

1. 系统会询问患者姓名（如果未提供）
2. 询问是否有病历文件需要上传
3. 逐步询问症状细节（持续时间、严重程度、伴随症状等）
4. 进行医学文献搜索
5. 提供诊断结果和治疗建议
6. 生成完整的 SOAP 报告

### 输出文件

诊断完成后，系统会在 `notes/` 目录下生成以下文件：

- **问诊记录**：`[患者名]-PatientNote-[时间戳].md` - 实时问诊过程的详细记录
- **诊断报告**：`[患者名]-report-[时间戳].md` - SOAP 格式的最终报告

时间戳格式：`yyyyMMdd_HHmmss_SSS`

## 技术特点

- **低成本**：支持使用免费的 AI 模型，无需昂贵的 API 调用
- **高度集成**：与 OpenCode 深度集成，支持 ralph-loop 自动化工作流
- **文档安全**：提醒患者对敏感信息进行脱敏处理
- **紧急预警**：检测紧急症状时自动标记提醒

## 医疗免责声明

> ⚠️ **重要提示**
>
> 本系统是一个 AI 辅助工具，提供的诊断和治疗建议仅供参考，**不能替代专业医疗建议**。
>
> - 所有诊断结果应由专业医疗人员核实
> - 紧急情况请立即就医或拨打急救电话
> - 上传的病历文件请确保已删除敏感个人信息
> - 本系统的开发者不对因使用本系统而导致的任何健康问题负责

## 项目结构

```
ai-doctor-opencode/
├── .opencode/
│   ├── commands/
│   │   └── dr-diagnose.md    # 诊断命令定义
│   ├── package.json          # 项目依赖
│   └── node_modules/         # 依赖包
├── notes/                    # 生成的诊断报告
├── LICENSE                   # Apache 2.0 许可证
└── README.md                 # 项目说明文档
```

## 贡献

欢迎提交 Issue 和 Pull Request 来改进这个项目！

## 许可证

本项目采用 [Apache License 2.0](LICENSE) 许可证。

## 联系方式

如有问题或建议，请通过 GitHub Issues 联系。
